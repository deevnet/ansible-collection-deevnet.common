---
# roles/omada_controller/tasks/configure_firewall.yml

- name: Gather service facts (for firewalld detection)
  ansible.builtin.service_facts:

- name: Open TCP ports in firewalld for omada controller
  ansible.posix.firewalld:
    port: "{{ item }}/tcp"
    permanent: true
    state: enabled
    immediate: true
  loop: "{{ omada_firewall_ports_tcp }}"
  when:
    - "'firewalld.service' in ansible_facts.services"
    - ansible_facts.services['firewalld.service'].state == 'running'
  become: true

- name: Open UDP ports in firewalld for omada controller
  ansible.posix.firewalld:
    port: "{{ item }}/udp"
    permanent: true
    state: enabled
    immediate: true
  loop: "{{ omada_firewall_ports_udp }}"
  when:
    - "'firewalld.service' in ansible_facts.services"
    - ansible_facts.services['firewalld.service'].state == 'running'
  become: true
