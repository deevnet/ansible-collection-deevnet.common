---
# roles/artifacts/tasks/main.yml

- name: Install nginx
  ansible.builtin.import_tasks: install_nginx.yml

- name: Configure nginx
  ansible.builtin.import_tasks: configure_nginx.yml

- name: Fetch artifacts
  ansible.builtin.import_tasks: fetch_artifacts.yml

- name: Publish SSH keys
  ansible.builtin.include_tasks: publish_ssh_keys.yml
  loop: "{{ artifacts_ssh_keys }}"
  loop_control:
    loop_var: artifact_item

- name: Ensure Podman is installed (for image artifacts)
  ansible.builtin.dnf:
    name: podman
    state: present
  when: (artifacts_podman_images | default([])) | length > 0

- name: Download podman image artifacts
  ansible.builtin.include_tasks: fetch_podman_images.yml
  loop: "{{ artifacts_podman_images | default([]) }}"
  loop_control:
    loop_var: podman_artifact
