---
- name: Install nginx
  ansible.builtin.dnf:
    name: nginx
    state: present

- name: Gather service facts (for firewalld detection)
  ansible.builtin.service_facts:

- name: Open HTTP/HTTPS in firewalld when running
  ansible.posix.firewalld:
    service: "{{ item }}"
    permanent: true
    state: enabled
    immediate: true
  loop:
    - http
    - https
  when:
    - "'firewalld.service' in ansible_facts.services"
    - ansible_facts.services['firewalld.service'].state == 'running'
  become: true

- name: Enable and start nginx
  ansible.builtin.service:
    name: nginx
    enabled: true
    state: started
